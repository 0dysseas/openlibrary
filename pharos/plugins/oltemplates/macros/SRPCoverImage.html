$def with(book, size="M")

$ title = book.title_prefix + " " + book.title
$ coverid = get_cover_id(book.key)
$if coverid:
    $if size == "M":
        <div class="SRPCover">
            <img src="http://covers.openlibrary.org/b/id/$coverid-${size.upper()}.jpg" height="255" />
        </div>
    $else:
        <img src="http://covers.openlibrary.org/b/id/$coverid-${size.upper()}.jpg" height="58" style="border: 1px solid #666" />
$else:
    <div class="SRPCoverBlank">
    $if size == "M":
        <div class="BookTitle">
            $ author_names = ", ".join(a.name for a in book.authors) or book.by_statement
            $title
            <div class="Author">$author_names</div>
        </div>
    </div>