$def with (author, name)

$ _t = _.get_namespace('/type/edition')

$add_stylesheet("/static/css/freebase-controls.css")
$add_javascript("/static/js/jquery/freebase.suggest.js")

<input id="key_$name" type="hidden" name="$name" value="$author.key"/>
<input id="saved_name_$name" type="hidden" name="_saved_name_$name" value="$author.name"/>
<input id="name_$name" type="text" name="_name_$name" value="$author.name" style="width: 100%"/>

<div id="fberror_$name" style="display: none;">
    <div class="fb_error">$_t.author_dropdown</div><br>
<span id="hideerror"></div>
</div>

<div id="msg">

</div>

<script type="text/javascript">
    function new_author(name) {
        \$.post(
            '/addauthor', 
            {name: name}, 
            function(data, status) {
                if (status == "success") {
	            \$(document.getElementById("key_$name")).attr("value", data);
	            \$(document.getElementById("saved_name_$name")).attr("value", name);
                     alert("Author added.");
                }
                else {
                    alert("Error in creating author: " + status); 
                }
            }, 
            "text"
         );
    }

    jQuery(function(\$) {
        \$(document.getElementById("name_$name"))
            .freebaseSuggest({
                soft: false, 
                suggest_new: "$_t.author_create", 
                service_url: "http://" + window.location.host,
                ac_path: '/suggest/search', 
                blurb_path: '/suggest/blurb'
            })
            .bind("fb-select", function(e, data) {
	        \$(document.getElementById("key_$name")).attr("value", data.id);
	        \$(document.getElementById("saved_name_$name")).attr("value", data.name);
            })
            .bind("fb-select-new", function(e, data) {
                new_author(data.name);
            });

        \$(document.getElementById('key_$name')).parents('form')
            .bind("submit", function(e, data) {
                var v1 = \$(document.getElementById("saved_name_$name")).val();
                var v2 = \$(document.getElementById("name_$name")).val();

                if (v1 != v2) {
                    \$(document.getElementById("fberror_$name")).show()
                    \$(document.getElementById("name_$name")).focus();
                    return false;
                }
                return True;
            });
    });

</script>